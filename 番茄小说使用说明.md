# 番茄小说爬虫使用说明

## 功能简介

番茄小说爬虫模块是数据采集平台的第二个功能模块，提供三大核心功能：

1. **推荐列表爬取**：爬取番茄小说推荐页面，获取书名和书籍ID
2. **书籍详情爬取**：根据书名或ID爬取完整的书籍详情信息
3. **作者搜索**：搜索指定作者的所有作品

## 数据库设计

### 1. 推荐列表表（fanqie_recommend）
存储推荐书籍的基本信息：
- 书名
- 书籍ID（唯一）
- 详情页URL

### 2. 书籍详情表（fanqie_books）
存储完整的书籍详情：
- 书籍ID（唯一）
- 标题
- 作者
- 分类
- 状态（连载/完结）
- 简介
- 字数
- 章节数
- 封面图
- 最新章节
- 更新时间
- 详情页URL

### 3. 作者表（fanqie_authors）
存储作者信息：
- 作者名（唯一）
- 书籍数量

### 4. 作者书籍关联表（fanqie_author_books）
存储作者与书籍的关联关系：
- 作者名
- 书籍ID
- 书名
- 唯一索引：作者名+书籍ID

## 使用方法

### 1. 启动后端服务

```bash
# 方式1：使用批处理文件
start_backend.bat

# 方式2：直接运行 Python
python backend/api.py
```

### 2. 打开前端页面

1. 打开浏览器，访问 `frontend/home.html`
2. 点击"番茄小说爬虫"模块卡片
3. 进入番茄小说爬虫页面

### 3. 功能使用

#### 功能一：推荐列表

1. 点击"📖 推荐列表"标签页
2. 点击"爬取推荐列表"按钮，爬取最新推荐书籍
3. 或点击"展示数据库推荐"按钮，查看已保存的推荐
4. 点击任意书籍的"查看详情"按钮，跳转到详情页面

#### 功能二：书籍详情

1. 点击"📝 书籍详情"标签页
2. 输入书名（如：斗破苍穹）
3. 点击"爬取详情"按钮
4. 查看完整的书籍信息
5. 点击"查看作者其他作品"按钮，跳转到作者搜索

#### 功能三：作者搜索

1. 点击"👤 作者搜索"标签页
2. 输入作者名（如：天蚕土豆）
3. 点击"搜索作者"按钮，爬取该作者的所有作品
4. 或点击"展示数据库数据"按钮，查看已保存的作者作品
5. 点击任意书籍的"查看详情"按钮，查看书籍详情

## API 接口

### 推荐列表

#### 爬取推荐列表
```
POST /api/crawl/fanqie/recommend
```

响应：
```json
{
    "success": true,
    "count": 50,
    "books": [
        {
            "书名": "斗破苍穹",
            "书籍ID": "123456",
            "详情页URL": "https://..."
        }
    ],
    "total_crawled": 50
}
```

#### 获取数据库推荐
```
GET /api/fanqie/recommend?limit=100
```

### 书籍详情

#### 爬取书籍详情
```
POST /api/crawl/fanqie/detail?book_name=斗破苍穹
POST /api/crawl/fanqie/detail?book_id=123456
```

响应：
```json
{
    "success": true,
    "book": {
        "书籍ID": "123456",
        "标题": "斗破苍穹",
        "作者": "天蚕土豆",
        "分类": "玄幻",
        "状态": "完结",
        "简介": "...",
        "字数": "500万字",
        "章节数": "1648章",
        "封面图": "https://...",
        "最新章节": "大结局",
        "更新时间": "2024-01-01",
        "详情页URL": "https://..."
    }
}
```

#### 获取数据库详情
```
GET /api/fanqie/detail/{book_id}
```

### 作者搜索

#### 搜索作者作品
```
POST /api/crawl/fanqie/author?author_name=天蚕土豆
```

响应：
```json
{
    "success": true,
    "author": "天蚕土豆",
    "count": 5,
    "books": [
        {
            "书名": "斗破苍穹",
            "书籍ID": "123456",
            "作者": "天蚕土豆",
            "详情页URL": "https://..."
        }
    ],
    "total_crawled": 5
}
```

#### 获取数据库作者作品
```
GET /api/fanqie/author/{author_name}
```

## 工作流程

### 推荐列表 → 书籍详情
1. 爬取推荐列表，获取书名和ID
2. 推荐数据保存到 `fanqie_recommend` 表
3. 点击"查看详情"，根据ID爬取完整详情
4. 详情数据保存到 `fanqie_books` 表
5. 同时保存作者信息到 `fanqie_authors` 表

### 书籍详情 → 作者搜索
1. 查看书籍详情，获取作者名
2. 点击"查看作者其他作品"
3. 搜索该作者的所有书籍
4. 作者书籍关联保存到 `fanqie_author_books` 表

### 作者搜索 → 书籍详情
1. 搜索作者，获取作者的所有书籍列表
2. 点击任意书籍的"查看详情"
3. 查看或爬取该书籍的完整详情

## 数据去重机制

1. **推荐列表**：基于书籍ID去重
2. **书籍详情**：基于书籍ID去重（更新模式）
3. **作者书籍关联**：基于作者名+书籍ID去重

## 命令行模式

也可以直接运行 Python 脚本：

```bash
python fanqie.py
```

选择功能：
1. 爬取推荐列表
2. 爬取书籍详情
3. 搜索作者书籍

## 注意事项

1. **MySQL 服务必须启动**
2. **配置正确的数据库密码**（在 `db_config.py` 中）
3. 数据库和表会在首次运行时自动创建
4. 推荐列表只包含书名和ID，需要点击"查看详情"获取完整信息
5. 书籍详情会自动关联作者信息
6. 作者搜索会建立作者与书籍的关联关系

## 常见问题

### Q: 推荐列表和书籍详情有什么区别？
A: 推荐列表只包含书名和ID，用于快速浏览；书籍详情包含完整信息（作者、分类、简介等）

### Q: 如何查看某本书的详细信息？
A: 在推荐列表中点击"查看详情"，或在书籍详情页面输入书名

### Q: 如何查找某个作者的所有作品？
A: 在作者搜索页面输入作者名，或在书籍详情页点击"查看作者其他作品"

### Q: 数据会重复吗？
A: 不会，系统使用唯一索引进行去重

### Q: 为什么要分三个功能？
A: 
- 推荐列表：快速浏览，减少数据量
- 书籍详情：按需获取完整信息
- 作者搜索：建立作者与作品的关联

## 技术栈

- **爬虫框架**: feapder
- **后端框架**: FastAPI
- **前端框架**: Vue.js 3
- **数据库**: MySQL（使用 DBUtils 连接池）
- **HTTP 客户端**: Axios

## 许可证

MIT License
