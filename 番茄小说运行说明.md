# 番茄小说爬虫运行说明

## ✅ 测试结果

所有功能测试通过！

### 测试1：解析功能测试
```bash
python test_fanqie_parser.py
```
结果：
- ✅ 获取书籍信息：通过
- ✅ 获取章节内容：通过
- ✅ 字符解码：通过

### 测试2：模块导入测试
```bash
python simple_test.py
```
结果：
- ✅ 模块导入成功
- ✅ 爬虫实例创建成功
- ✅ fanqie_web_detail 模块正常

## 📁 文件说明

### 核心文件

1. **fanqie.py** - 主爬虫文件
   - `FanQieRecommendSpider` - 推荐列表爬虫
   - `FanQieDetailSpider` - 书籍详情爬虫
   - `FanQieAuthorSpider` - 作者搜索爬虫

2. **fanqie_web_detail.py** - 独立解析工具
   - `FanQieWebDetail` 类
   - 使用 BeautifulSoup 解析 HTML
   - 包含字符解码功能

### 测试文件

1. **test_fanqie_parser.py** - 解析功能测试
2. **test_bs4.py** - BeautifulSoup 测试
3. **simple_test.py** - 基础功能测试
4. **demo_fanqie.py** - 功能演示脚本

## 🚀 运行方式

### 方式1：交互式命令行
```bash
python fanqie.py
```
然后选择功能：
- 1 - 爬取推荐列表
- 2 - 爬取书籍详情
- 3 - 搜索作者书籍

### 方式2：功能演示
```bash
python demo_fanqie.py
```
自动演示所有三个功能

### 方式3：独立解析工具
```bash
python fanqie_web_detail.py
```
使用独立的解析工具下载整本书

### 方式4：Web API（推荐）
```bash
# 启动后端服务
python backend/api.py

# 然后在浏览器中打开
frontend/home.html
```

## 🔧 技术改进

### 原始版本（fanqie_detail.py）
- 使用 `parsel` 模块解析 HTML
- 使用 xpath 选择器

### 新版本（fanqie_web_detail.py + fanqie.py）
- 使用 `BeautifulSoup` 解析 HTML
- 使用 CSS 选择器
- 更加通用和易用
- 保留了完整的字符解码功能

## 📊 功能对比

| 功能 | 原版本 | 新版本 | 状态 |
|------|--------|--------|------|
| HTML 解析 | parsel | BeautifulSoup | ✅ 已更新 |
| 选择器 | xpath | CSS | ✅ 已更新 |
| 字符解码 | ✅ | ✅ | ✅ 保留 |
| 推荐列表 | ❌ | ✅ | ✅ 新增 |
| 书籍详情 | ✅ | ✅ | ✅ 优化 |
| 作者搜索 | ❌ | ✅ | ✅ 新增 |
| 数据库存储 | ❌ | ✅ | ✅ 新增 |

## 🎯 核心功能

### 1. 推荐列表爬取
- 爬取番茄小说推荐页面
- 只获取书名和书籍ID
- 快速浏览，减少数据量

### 2. 书籍详情爬取
- 根据书名或ID爬取完整详情
- 包含：标题、作者、分类、状态、简介、字数、章节数等
- 自动解码特殊字符

### 3. 作者搜索
- 搜索指定作者的所有作品
- 建立作者与书籍的关联关系
- 支持批量获取

## 💾 数据库设计

### 表结构
1. **fanqie_recommend** - 推荐列表（书名+ID）
2. **fanqie_books** - 书籍详情（完整信息）
3. **fanqie_authors** - 作者信息
4. **fanqie_author_books** - 作者书籍关联

### 去重机制
- 推荐列表：基于书籍ID
- 书籍详情：基于书籍ID（更新模式）
- 作者关联：基于作者名+书籍ID

## 🌐 Web 界面

访问 `frontend/fanqie.html` 可以使用 Web 界面：

### 三个标签页
1. **📖 推荐列表** - 浏览推荐书籍
2. **📝 书籍详情** - 查看完整信息
3. **👤 作者搜索** - 搜索作者作品

### 功能特点
- 美观的界面设计
- 实时爬取和数据库查询
- 流畅的页面跳转
- 支持网格和列表视图

## ⚠️ 注意事项

1. **网络连接**：需要能够访问 fanqienovel.com
2. **爬取速度**：建议设置合理的延迟，避免被封IP
3. **数据库**：使用数据库功能需要先启动 MySQL 服务
4. **字符解码**：已内置字符映射表，自动解码特殊字符

## 📝 使用示例

### Python 代码示例
```python
from fanqie import run_recommend_spider, run_detail_spider, run_author_spider

# 爬取推荐列表
results = run_recommend_spider(use_mysql=False, max_books=10)
print(f"获取到 {len(results['books'])} 本推荐书籍")

# 爬取书籍详情
result = run_detail_spider(book_id="7276384138653862966", use_mysql=False)
if result['success']:
    print(f"书名: {result['book']['标题']}")

# 搜索作者
results = run_author_spider(author_name="三九音域", use_mysql=False)
print(f"找到 {len(results['books'])} 本作品")
```

## 🎉 总结

番茄小说爬虫已经成功重构，所有功能正常运行！

- ✅ 使用 BeautifulSoup 替代 parsel
- ✅ 保留完整的字符解码功能
- ✅ 新增推荐列表和作者搜索功能
- ✅ 支持数据库存储
- ✅ 提供 Web 界面
- ✅ 所有测试通过

可以开始使用了！🚀
